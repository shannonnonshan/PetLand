{{#section 'css'}}
    <link rel="stylesheet" href="/static/css/cssPet/pet.adoptedlist.css">
{{/section}}

{{#section 'pet'}}
    <script>
        document.addEventListener('DOMContentLoaded', () => {
          const params = new URLSearchParams(window.location.search);
          const status = params.get('status');

        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
        });

        let selector;
        if (status) {
            selector = `.nav-link[href*="status=${status}"]`;
        } else {
            selector = `.nav-link[href="/pet/viewAdopted"]`;
        }

        const currentLink = document.querySelector(selector);
        if (currentLink) {
            currentLink.classList.add('active');
        }
    });

</script>
<script>
  document.querySelectorAll('.btn-cancel').forEach(btn => {
    btn.addEventListener('click', function () {
      const petId = this.getAttribute('data-id');

      Swal.fire({
        title: 'Do you really want to cancel?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes',
        cancelButtonText: 'No',
        reverseButtons: true
      }).then((result) => {
        if (result.isConfirmed) {
          fetch('/pet/cancel-adopt', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ petid: petId })
          })
          .then(response => response.json())  
          .then(data => {
            if (data.message) {
              Swal.fire({
                icon: 'success',
                title: data.message,
                showConfirmButton: false,
                timer: 1500
              }).then(() => {
                // Redirect to /pet/byCat after success
                window.location.href = '/pet/viewAdopted';
              });
            } else {
              Swal.fire({
                icon: 'error',
                title: 'Phê duyệt thất bại!',
                text: 'Vui lòng thử lại sau.'
              });
            }
          })
          .catch(error => {
            console.error('Lỗi:', error);
            Swal.fire({
              icon: 'error',
              title: 'Đã xảy ra lỗi!',
              text: 'Không thể kết nối tới máy chủ.'
            });
          });
        } else {
          // User canceled the action, no further steps
          console.log("User canceled the action.");
        }
      });
    });
  });
</script>
{{/section}}
<div class="tw-mx-[10%]">
  <div class="card text-center tw-mt-10">
    <div class="card-header">
      
      <ul class="nav nav-tabs card-header-tabs">
        <li class="nav-item">
          <a class="nav-link active" href="/pet/viewAdopted">All</a>
        </li>
        <li class="nav-item">
          <a class="nav-link " href="/pet/viewAdopted?status=adopt_approved">Adopting</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/pet/viewAdopted?status=adopt_requested">Request</a>
        </li>
        
        <li class="nav-item">
          <a class="nav-link" href="/pet/viewAdopted?status=adopt_completed">Completed</a>
        </li>
      </ul>
    </div>

    <div class="tab-content mt-3" id="booking-tabContent">
      <div class="tab-pane fade show active" id="content-all" role="tabpanel" aria-labelledby="tab-all" tabindex="0">
        {{#if list.length}}
        {{#each list}}
            <div class="card-calendar tw-bg-white tw-shadow-lg tw-rounded-xl tw-p-6 tw-mb-4 tw-border tw-border-gray-200 tw-text-sm tw-text-left">
                <div class="tw-flex tw-justify-between tw-items-center mb-4">
                    <h5 class="tw-font-semibold tw-text-xl tw-text-gray-800" name="id">#{{_id}}</h5>
                    <span class="bg">{{formatDate adoptDate}}</span>
                </div>

                <!-- Pet details -->
                <div class="tw-mt-4 tw-text-gray-600">
                    <p class="tw-font-medium tw-text-lg">Pet Name: <span class="tw-font-semibold tw-text-gray-800">{{name}}</span></p>
                    <p class="tw-text-sm">Specie: <span class="tw-font-semibold tw-text-green-600">{{specie}}</span></p>
                </div>
                {{#if (eq status 'adopt_completed')}}
                <div class="button-container button flex justify-end space-x-4 mt-6">
                    <a href="/pet/detail/{{_id}}" class="btn-view tw-cursor-pointer">
                        <i class="cart-icon ion-bag tw-mr-2"></i>VIEW DETAIL
                    </a>
                </div>
                {{else}}
                <div class="button-container button flex justify-end space-x-4 mt-6">
                    <a href="#" class="btn-cancel tw-cursor-pointer" data-id="{{_id}}">
                        CANCEL
                    </a>
                    <a href="/pet/detail/{{_id}}" class="btn-view tw-cursor-pointer">
                        <i class="cart-icon ion-bag tw-mr-2"></i>VIEW DETAIL
                    </a>
                </div>
                {{/if}}
            </div>
        {{/each}}
        {{else}}
        <div class="tw-text-center tw-text-gray-500 tw-mt-10">
          None..
        </div>
      {{/if}}
      </div>
    </div>
  </div>
</div>

